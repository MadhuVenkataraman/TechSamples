<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:ws="http://www.springframework.org/schema/integration/ws"
       xmlns:int="http://www.springframework.org/schema/integration"
       xmlns:oxm="http://www.springframework.org/schema/oxm"

       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
 http://www.springframework.org/schema/oxm http://www.springframework.org/schema/oxm/spring-oxm-1.5.xsd


		http://www.springframework.org/schema/integration/ws http://www.springframework.org/schema/integration/ws/spring-integration-ws.xsd
		http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd">
    <int:channel id="inputChannel"></int:channel>
    <int:channel id="outputChannel">
        <int:queue  capacity="100"/>
    </int:channel>
    <int:channel id="requestChannel"></int:channel>
    <int:channel id="transformChannel"></int:channel>
    <int:channel id="routingChannel"></int:channel>
    <int:channel id="errorChannel">

    </int:channel>
    <int:channel id="responseChannel">

    </int:channel>

    <!-- Initial service request -->
    <int:gateway id="systemEntry" default-request-channel="requestChannel" default-reply-channel="transformChannel"
                 service-interface="com.virtusa.workouts.springworkout.service.AccountSystemGateway" />

   <!-- <oxm:jaxb2-marshaller id="marshaller" context-path="com.virtusa.workouts.springworkout.types" />
    -->
    <ws:outbound-gateway id="accountGateway"
    request-channel="requestChannel" reply-channel="transformChannel"
                         uri="http://localhost:8090/ws/account"/>

  <int:router id="cardTypeRouter" input-channel="routingChannel" default-output-channel="responseChannel"
                expression="payload">
      <int:mapping value="from spend" channel="responseChannel"/>
      <int:mapping value="from grow" channel="responseChannel"/>
      <int:mapping value="from savings" channel="errorChannel"/>
      <int:mapping value="from credit" channel="errorChannel"/>
  </int:router>

    <int:transformer input-channel="transformChannel" output-channel="routingChannel"
                     ref="accountTransformService" method="transform">
    </int:transformer>
    <int:filter input-channel="inputChannel" expression="!payload.contains('savings')"
            output-channel="requestChannel"  discard-channel="discardChannel"/>

    <int:transformer input-channel="discardChannel" output-channel="outputChannel"
                     ref="savingCardFilterTransform" method="getPayload">
    </int:transformer>
    <int:transformer input-channel="responseChannel" output-channel="outputChannel"
                     ref="successMessageTransform" method="getPayload">
    </int:transformer>
    <int:transformer input-channel="errorChannel" output-channel="outputChannel"
                     ref="creditCardErrorMsgTransform" method="getPayload">
    </int:transformer>
    <!--
    <int:chain input-channel="inputChannel" output-channel="soapResultChannel">
        <ws:header-enricher>
            <ws:soap-action expression="headers.soapaction"/>
        </ws:header-enricher>
        <ws:outbound-gateway id="soapGateway"
                             uri="{wsdlURL}"
                             encode-uri="false">
        <ws:uri-variable name="wsdlURL" expression="headers.serviceurl"/>
    </ws:outbound-gateway>
</int:chain>-->
</beans>